<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack打包优化 | 大木_笔记</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="记录工作和学习过程中的笔记">
    <link rel="preload" href="/ysblog/assets/css/0.styles.e661b340.css" as="style"><link rel="preload" href="/ysblog/assets/js/app.05f40ecb.js" as="script"><link rel="preload" href="/ysblog/assets/js/2.101f09ec.js" as="script"><link rel="preload" href="/ysblog/assets/js/7.316c9739.js" as="script"><link rel="prefetch" href="/ysblog/assets/js/10.aba1ce7e.js"><link rel="prefetch" href="/ysblog/assets/js/11.232cd946.js"><link rel="prefetch" href="/ysblog/assets/js/12.22125e24.js"><link rel="prefetch" href="/ysblog/assets/js/13.641bf3cf.js"><link rel="prefetch" href="/ysblog/assets/js/14.24ccc943.js"><link rel="prefetch" href="/ysblog/assets/js/15.56161087.js"><link rel="prefetch" href="/ysblog/assets/js/16.205bd373.js"><link rel="prefetch" href="/ysblog/assets/js/17.bd633a29.js"><link rel="prefetch" href="/ysblog/assets/js/18.33d43e7e.js"><link rel="prefetch" href="/ysblog/assets/js/19.a2911d20.js"><link rel="prefetch" href="/ysblog/assets/js/20.07624a1c.js"><link rel="prefetch" href="/ysblog/assets/js/21.a4151fba.js"><link rel="prefetch" href="/ysblog/assets/js/22.141540b5.js"><link rel="prefetch" href="/ysblog/assets/js/23.91fde9ee.js"><link rel="prefetch" href="/ysblog/assets/js/24.cca104ac.js"><link rel="prefetch" href="/ysblog/assets/js/25.5cc0b6e3.js"><link rel="prefetch" href="/ysblog/assets/js/26.5835c007.js"><link rel="prefetch" href="/ysblog/assets/js/27.132ee99d.js"><link rel="prefetch" href="/ysblog/assets/js/28.dae014a1.js"><link rel="prefetch" href="/ysblog/assets/js/29.a922ac25.js"><link rel="prefetch" href="/ysblog/assets/js/3.859ec158.js"><link rel="prefetch" href="/ysblog/assets/js/30.215eea15.js"><link rel="prefetch" href="/ysblog/assets/js/31.a6a3ecad.js"><link rel="prefetch" href="/ysblog/assets/js/32.2f04c66d.js"><link rel="prefetch" href="/ysblog/assets/js/33.2e16f460.js"><link rel="prefetch" href="/ysblog/assets/js/34.6f7d019b.js"><link rel="prefetch" href="/ysblog/assets/js/35.72665780.js"><link rel="prefetch" href="/ysblog/assets/js/36.f8c9d77b.js"><link rel="prefetch" href="/ysblog/assets/js/37.aa3efe17.js"><link rel="prefetch" href="/ysblog/assets/js/38.6cb4e1db.js"><link rel="prefetch" href="/ysblog/assets/js/39.43e17a0d.js"><link rel="prefetch" href="/ysblog/assets/js/4.ee24ae0f.js"><link rel="prefetch" href="/ysblog/assets/js/5.bd54095f.js"><link rel="prefetch" href="/ysblog/assets/js/6.dcc1de99.js"><link rel="prefetch" href="/ysblog/assets/js/8.87405e82.js"><link rel="prefetch" href="/ysblog/assets/js/9.de91e189.js">
    <link rel="stylesheet" href="/ysblog/assets/css/0.styles.e661b340.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ysblog/" class="home-link router-link-active"><!----> <span class="site-name">大木_笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ysblog/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ysblog/web/JS/blog1.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/browser/blog1.html" class="nav-link">
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/jQuery/blog1.html" class="nav-link">
  jQuery
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/underscore/blog1.html" class="nav-link">
  underscore
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/webpack/blog1.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/vue/blog1.html" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构" class="dropdown-title"><span class="title">数据结构</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据结构" class="mobile-dropdown-title"><span class="title">数据结构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ysblog/DataStructure/queue/blog1.html" class="nav-link">
  队列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ysblog/other/regex/blog1.html" class="nav-link">
  正则表达式
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ysblog/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ysblog/web/JS/blog1.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/browser/blog1.html" class="nav-link">
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/jQuery/blog1.html" class="nav-link">
  jQuery
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/underscore/blog1.html" class="nav-link">
  underscore
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/webpack/blog1.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/ysblog/web/vue/blog1.html" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构" class="dropdown-title"><span class="title">数据结构</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据结构" class="mobile-dropdown-title"><span class="title">数据结构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ysblog/DataStructure/queue/blog1.html" class="nav-link">
  队列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ysblog/other/regex/blog1.html" class="nav-link">
  正则表达式
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ysblog/web/webpack/blog1.html" class="sidebar-link">webpack基本配置</a></li><li><a href="/ysblog/web/webpack/blog2.html" aria-current="page" class="active sidebar-link">webpack打包优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ysblog/web/webpack/blog2.html#一、减少项目依赖深度" class="sidebar-link">一、减少项目依赖深度</a></li><li class="sidebar-sub-header"><a href="/ysblog/web/webpack/blog2.html#二、dll处理" class="sidebar-link">二、Dll处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ysblog/web/webpack/blog2.html#所需插件" class="sidebar-link">所需插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/ysblog/web/webpack/blog2.html#三、通过include减少loder的范围" class="sidebar-link">三、通过include减少loder的范围</a></li><li class="sidebar-sub-header"><a href="/ysblog/web/webpack/blog2.html#四、happypack-开启多线程" class="sidebar-link">四、HappyPack，开启多线程</a></li><li class="sidebar-sub-header"><a href="/ysblog/web/webpack/blog2.html#五、uglify优化" class="sidebar-link">五、Uglify优化</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack打包优化"><a href="#webpack打包优化" class="header-anchor">#</a> webpack打包优化</h1> <h2 id="一、减少项目依赖深度"><a href="#一、减少项目依赖深度" class="header-anchor">#</a> 一、减少项目依赖深度</h2> <p>减少模块与模块的依赖深度，避免比如模块A依赖于模块B，模块B依赖模块C，模块C依赖模块D，模块D依赖模块E，这样做会增加webpack打包的依赖查找时间。</p> <h2 id="二、dll处理"><a href="#二、dll处理" class="header-anchor">#</a> 二、Dll处理</h2> <p>Dll处理是一种简单有效的打包方式，通常的打包过程中，引入的第三方库比如：jQuery、Vue、Lodash、element等等众库会被打包进入bundle.js文件。这些文件基本上都不会有所改变，每次执行打包都将他们打包无疑是一种浪费。</p> <p>Dll处理就是提前将这些第三方库打包成一个dll.js，自己编写的业务代码打包进入bundle.js，之后只用打包bundle.js就可以了。</p> <h3 id="所需插件"><a href="#所需插件" class="header-anchor">#</a> 所需插件</h3> <p>webpack.DllPlugin、webpack.DllReferencePlugin、dd-asset-html-webpack-plugin</p> <p>通过DllPlugin来对那些我们引用但是绝对不会修改的npm包来进行预编译，再通过DllReferencePlugin将预编译的模块加载进来。需要配合add-asset-html-webpack-plugin（第三方库）一起使用。</p> <p>打包第三方库，新建webpack.dll.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//webpack.dll.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    vendor<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//需要打包的第三方库</span>
      <span class="token string">'jquery'</span><span class="token punctuation">,</span>
      <span class="token string">'lodash'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/src/dll'</span><span class="token punctuation">,</span> <span class="token comment">//第三方库打包后生成的js文件目录</span>
    filename<span class="token operator">:</span> <span class="token string">'./[name].js'</span><span class="token punctuation">,</span>      <span class="token comment">//生成的js文件名称</span>
    library<span class="token operator">:</span> <span class="token string">'[name]'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      path<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/src/dll/[name].json'</span><span class="token punctuation">,</span> <span class="token comment">//生成的json文件</span>
      name<span class="token operator">:</span> <span class="token string">'[name]'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行webpack --config webpack.dll.js，生成dll文件</p> <div class="language- extra-class"><pre class="language-text"><code>- src
-- dll
--- vendor.js
--- vendor.json
</code></pre></div><p>在webpack.config.js中配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> AddAssetHtmlPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'index_bundle.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/dll/vendor.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filepath<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/dll/vendor.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将生成的文件插入到html中</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>运行webpack，用dll打包时间1364ms，没有用dll打包时间3758ms。减少了三倍左右的时间</p> <h2 id="三、通过include减少loder的范围"><a href="#三、通过include减少loder的范围" class="header-anchor">#</a> 三、通过include减少loder的范围</h2> <p>对loder进行配置，</p> <ol><li>include是指定该loder处理指定文件夹下面的文件。</li> <li>exclude是不处理指定文件夹下面的文件。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
      loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/webpack-dev-server/client'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="四、happypack-开启多线程"><a href="#四、happypack-开启多线程" class="header-anchor">#</a> 四、HappyPack，开启多线程</h2> <p>从一诞生，JavaScript就是单线程，运行在Node.js之上的Webpack也是单线程。</p> <p>我们可以通过HappPack插件开启多线程。当loader解析文件时， HappyPack将位于webpack和主要源文件（例如JS源）之间。每次webpack解析模块时，HappyPack都会获取该模块及其所有依赖项，并将这些文件分发到多个工作程序“线程”。</p> <p>这些线程实际上是编译器调用时的简单节点进程。当编译文件时，HappyPack提供这些线程给loader，最终作用于chunk。
<img src="data:image/png;base64,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" alt=""></p> <p>webpack.config.js中配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//node自带的os模块，取得操作系统信息</span>
<span class="token keyword">const</span> happyThreadPool <span class="token operator">=</span> HappyPack<span class="token punctuation">.</span><span class="token function">ThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span> size<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//建立线程池，根据当前系统的cpu内核数量开进程</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>  
        loader<span class="token operator">:</span> <span class="token string">'happypack/loader?id=happyBabel'</span><span class="token punctuation">,</span> <span class="token comment">//把对.js 的文件处理交给id为happyBabel 的HappyPack 的实例执行，替换babel-loader。id对应plugin中的id</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">//用id来标识 happypack处理那里类文件</span>
      id<span class="token operator">:</span> <span class="token string">'happyBabel'</span><span class="token punctuation">,</span>
      <span class="token comment">//如何处理  用法和loader 的配置一样</span>
      loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader?cacheDirectory=true'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">//共享进程池</span>
      threadPool<span class="token operator">:</span> happyThreadPool<span class="token punctuation">,</span>
      <span class="token comment">//允许 HappyPack 输出日志</span>
      verbose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参数</p> <ul><li><p><code>id: String</code> 用唯一的标识符 id 来代表当前的 HappyPack 是用来处理一类特定的文件。</p></li> <li><p><code>loaders: Array</code> 用法和 webpack Loader 配置中一样，happpack代替的loader。</p></li> <li><p><code>threads: Number</code> 代表开启几个子进程去处理这一类型的文件，默认是3个，类型必须是整数。</p></li> <li><p><code>verbose: Boolean</code> 是否允许 HappyPack 输出日志，默认是 true。</p></li> <li><p><code>threadPool: HappyThreadPool</code> 代表共享进程池，即多个 HappyPack 实例都使用同一个共享进程池中的子进程去处理任务，以防止资源占用过多。</p></li> <li><p><code>verboseWhenProfiling: Boolean</code> 开启webpack --profile ,仍然希望HappyPack产生输出。</p></li> <li><p><code>debug: Boolean</code> 启用debug 用于故障排查。默认 false。</p></li></ul> <p>运行打包命令，可以看出下列开启了多线程打包
<img src="/ysblog/assets/img/11111.5e7ea583.png" alt=""></p> <p>当项目较小时，不建议使用happypack，开启happypack也需要时间，耗时不一定比不开少。项目较大的时候才能体现出来效果</p> <h2 id="五、uglify优化"><a href="#五、uglify优化" class="header-anchor">#</a> 五、Uglify优化</h2> <p>webpack4自动开启Uglify优化</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ysblog/web/webpack/blog1.html" class="prev">
        webpack基本配置
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ysblog/assets/js/app.05f40ecb.js" defer></script><script src="/ysblog/assets/js/2.101f09ec.js" defer></script><script src="/ysblog/assets/js/7.316c9739.js" defer></script>
  </body>
</html>
